!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@fingerprintjs/fingerprintjs"),require("crypto-es"),require("js-cookie")):"function"==typeof define&&define.amd?define(["exports","@fingerprintjs/fingerprintjs","crypto-es","js-cookie"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).SecureStorage={},e.FingerprintJS,e.CryptoES,e.Cookies)}(this,(function(e,t,r,i){"use strict";function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n,c=s(t),o=s(r),a=s(i);!function(e){e.AES="aes",e.DES="des",e.TDES="tdes",e.Rabbit="rabbit",e.RC4="rc4"}(n||(n={}));const y=(e,t)=>{let r=o.default.lib.WordArray.random(16);t&&(r=o.default.enc.Hex.parse(t));const i=((e,t)=>o.default.PBKDF2(e,t,{keySize:4})?.toString())(e,r);return{key:i,salt:r.toString(o.default.enc.Hex)}};class p{static browserFingerPrint;_encrypt=o.default.AES.encrypt;_decrypt=o.default.AES.decrypt;_isInitialized=!1;_storage=window?.localStorage??localStorage;_encryptionSecret={expires:90};config={encodingType:n.AES,storageNamespace:"secure"};constructor(e){this.setConfig(e),this.setCryptoMethods()}initAsync=async()=>{if(void 0!==this._encryptionSecret.key)return void(this._isInitialized=!0);if(!p.browserFingerPrint){const e=await c.default.load(),t=await e.get();p.browserFingerPrint=t.visitorId,Object.freeze(p.browserFingerPrint)}const e=this.getSaltOrDefaultFromSecurePlace();this.setEncryptionSecret(e),this._isInitialized=!0};clear=()=>{for(let e=0;e<this._storage.length;e++){const t=this._storage.key(e);t?.startsWith(`${this.config.storageNamespace}.`)&&this._storage.removeItem(t)}};getItem=e=>{this.throwIfNotInitialized(),e=this.getNamespaceKey(e);const t=this._storage.getItem(e);if(null===t)return null;const r=this._decrypt(t,this._encryptionSecret.key).toString(o.default.enc.Utf8);try{return JSON.parse(r)}catch(e){return r}};removeItem=e=>{e=this.getNamespaceKey(e),this._storage.removeItem(e)};setItem=(e,t)=>{this.throwIfNotInitialized(),e=this.getNamespaceKey(e);let r=t;"string"!=typeof t&&(r=JSON.stringify(t));const i=this._encrypt(r,this._encryptionSecret.key);this._storage.setItem(e,i.toString())};get metaKey(){return`${this.config.storageNamespace}_metaKey`}getNamespaceKey=e=>(this.throwIfKeyIsUndefined(e),`${this.config.storageNamespace}.${e}`);throwIfNotInitialized(){if(!this._isInitialized)throw new Error("Secure Storage: Is not initialized.")}throwIfKeyIsUndefined(e){if(!e)throw new Error("Secure Storage: a key must be provided.")}setEncryptionSecret(e){if(!p.browserFingerPrint)throw new Error("Secure Storage: Browser finger print is not set.");if(!e){const e=(t=p.browserFingerPrint,y(t));return this.setSaltToSecurePlace(e),this._encryptionSecret.key=e.key,void Object.freeze(this._encryptionSecret)}var t;this._encryptionSecret.key=y(p.browserFingerPrint,e).key,Object.freeze(this._encryptionSecret)}setSaltToSecurePlace(e){a.default.set(this.metaKey,e.salt,{secure:!0,sameSite:"Strict",expires:this._encryptionSecret.expires})}getSaltOrDefaultFromSecurePlace(){return a.default.get(this.metaKey)}setConfig(e){this.config.encodingType=e?.encodingType??this.config.encodingType,this.config.storageNamespace=e?.storageNamespace??this.config.storageNamespace,this.setConfigSecret(e)}setConfigSecret(e){void 0!==e?.encryptionSecret&&(this._encryptionSecret=e.encryptionSecret,this._encryptionSecret.key&&Object.freeze(this._encryptionSecret))}setCryptoMethods(){switch(this.config.encodingType){case n.TDES:this._encrypt=o.default.TripleDES.encrypt,this._decrypt=o.default.TripleDES.decrypt;break;case n.DES:this._encrypt=o.default.DES.encrypt,this._decrypt=o.default.DES.decrypt;break;case n.Rabbit:this._encrypt=o.default.Rabbit.encrypt,this._decrypt=o.default.Rabbit.decrypt;break;case n.RC4:this._encrypt=o.default.RC4.encrypt,this._decrypt=o.default.RC4.decrypt;break;case n.AES:this._encrypt=o.default.AES.encrypt,this._decrypt=o.default.AES.decrypt}}}const f=new class{generateSecretKeyWithSalt=y;async createAsync(e){const t=new p(e);return await t.initAsync(),{clear:t.clear,setItem:t.setItem,getItem:t.getItem,removeItem:t.removeItem}}};e.SecureStorage=f,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=secure-storage.umd.js.map
