!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@fingerprintjs/fingerprintjs"),require("crypto-es"),require("js-cookie")):"function"==typeof define&&define.amd?define(["@fingerprintjs/fingerprintjs","crypto-es","js-cookie"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).SecureStorage=t(e.FingerprintJS,e.CryptoES,e.Cookies)}(this,(function(e,t,r){"use strict";function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s,n=i(e),c=i(t),o=i(r);!function(e){e.AES="aes",e.DES="des",e.TDES="tdes",e.Rabbit="rabbit",e.RC4="rc4"}(s||(s={}));const a=(e,t)=>{let r=c.default.lib.WordArray.random(16);t&&(r=c.default.enc.Hex.parse(t));const i=((e,t)=>c.default.PBKDF2(e,t,{keySize:4})?.toString())(e,r);return{key:i,salt:r.toString(c.default.enc.Hex)}};class y{static browserFingerPrint;_encrypt=c.default.AES.encrypt;_decrypt=c.default.AES.decrypt;_isInitialized=!1;_storage=window?.localStorage??localStorage;_encryptionSecret={expires:90};config={encodingType:s.AES,storageNamespace:"secure"};constructor(e){this.setConfig(e),this.setCryptoMethods()}initAsync=async()=>{if(void 0!==this._encryptionSecret.key)return void(this._isInitialized=!0);if(!y.browserFingerPrint){const e=await n.default.load(),t=await e.get();y.browserFingerPrint=t.visitorId,Object.freeze(y.browserFingerPrint)}const e=this.getSaltOrDefaultFromSecurePlace();this.setEncryptionSecret(e),this._isInitialized=!0};clear=()=>{for(let e=0;e<this._storage.length;e++){const t=this._storage.key(e);t?.startsWith(`${this.config.storageNamespace}.`)&&this._storage.removeItem(t)}};getItem=e=>{this.throwIfNotInitialized(),e=this.getNamespaceKey(e);const t=this._storage.getItem(e);if(null===t)return null;const r=this._decrypt(t,this._encryptionSecret.key).toString(c.default.enc.Utf8);try{return JSON.parse(r)}catch(e){return r}};removeItem=e=>{e=this.getNamespaceKey(e),this._storage.removeItem(e)};setItem=(e,t)=>{this.throwIfNotInitialized(),e=this.getNamespaceKey(e);let r=t;"string"!=typeof t&&(r=JSON.stringify(t));const i=this._encrypt(r,this._encryptionSecret.key);this._storage.setItem(e,i.toString())};get metaKey(){return`${this.config.storageNamespace}_metaKey`}getNamespaceKey=e=>(this.throwIfKeyIsUndefined(e),`${this.config.storageNamespace}.${e}`);throwIfNotInitialized(){if(!this._isInitialized)throw new Error("Secure Storage: Is not initialized.")}throwIfKeyIsUndefined(e){if(!e)throw new Error("Secure Storage: a key must be provided.")}setEncryptionSecret(e){if(!y.browserFingerPrint)throw new Error("Secure Storage: Browser finger print is not set.");if(!e){const e=(t=y.browserFingerPrint,a(t));return this.setSaltToSecurePlace(e),this._encryptionSecret.key=e.key,void Object.freeze(this._encryptionSecret)}var t;this._encryptionSecret.key=a(y.browserFingerPrint,e).key,Object.freeze(this._encryptionSecret)}setSaltToSecurePlace(e){o.default.set(this.metaKey,e.salt,{secure:!0,sameSite:"Strict",expires:this._encryptionSecret.expires})}getSaltOrDefaultFromSecurePlace(){return o.default.get(this.metaKey)}setConfig(e){this.config.encodingType=e?.encodingType??this.config.encodingType,this.config.storageNamespace=e?.storageNamespace??this.config.storageNamespace,this.setConfigSecret(e)}setConfigSecret(e){void 0!==e?.encryptionSecret&&(this._encryptionSecret=e.encryptionSecret,this._encryptionSecret.key&&Object.freeze(this._encryptionSecret))}setCryptoMethods(){switch(this.config.encodingType){case s.TDES:this._encrypt=c.default.TripleDES.encrypt,this._decrypt=c.default.TripleDES.decrypt;break;case s.DES:this._encrypt=c.default.DES.encrypt,this._decrypt=c.default.DES.decrypt;break;case s.Rabbit:this._encrypt=c.default.Rabbit.encrypt,this._decrypt=c.default.Rabbit.decrypt;break;case s.RC4:this._encrypt=c.default.RC4.encrypt,this._decrypt=c.default.RC4.decrypt;break;case s.AES:this._encrypt=c.default.AES.encrypt,this._decrypt=c.default.AES.decrypt}}}return new class{generateSecretKeyWithSalt=a;async createAsync(e){const t=new y(e);return await t.initAsync(),{clear:t.clear,setItem:t.setItem,getItem:t.getItem,removeItem:t.removeItem}}}}));
//# sourceMappingURL=secure-storage.umd.js.map
